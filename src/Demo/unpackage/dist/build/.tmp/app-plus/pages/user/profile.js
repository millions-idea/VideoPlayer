(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/profile"],{"0c69":function(e,n,o){},1397:function(e,n,o){"use strict";o.r(n);var t=o("6318"),s=o("e275");for(var i in s)"default"!==i&&function(e){o.d(n,e,function(){return s[e]})}(i);o("cff6");var a=o("2877"),h=Object(a["a"])(s["default"],t["a"],t["b"],!1,null,"703c0413",null);n["default"]=h.exports},6318:function(e,n,o){"use strict";var t=function(){var e=this,n=e.$createElement;e._self._c},s=[];o.d(n,"a",function(){return t}),o.d(n,"b",function(){return s})},9564:function(e,n,o){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var t=o("2f62");function s(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{},t=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),t.forEach(function(n){i(e,n,o[n])})}return e}function i(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}var a=function(){return o.e("common/vendor").then(o.t.bind(null,"2f96",7))},h={components:{http:a},onLoad:function(){this.queryPhone(),this.queryPayment(),this.queryWechat()},computed:s({},(0,t.mapState)(["hasLogin","profile"]),{getPhoneClassName:function(){return"foot "+this.phoneClassName},getPaymentClassName:function(){return"foot "+this.paymentClassName},getWechatClassName:function(){return"foot "+this.wechatClassName}}),methods:s({},(0,t.mapActions)(["setProfile","login","sysLogout"]),{updatePassword:function(){this.common.window.toNew("generics-form/generics-form",{formName:"Password",title:"修改登录密码",topLabel:"需要接收短信验证码进行身份验证",bottomLabel:"为确保您账户的安全及正常使用，依《网络安全法》相关要求，6月1日起会员账户需绑定手机。如您还未绑定，请尽快完成，感谢您的理解及支持！ ",placeholder:"请输入新的登录密码",maxLength:128,minLength:6,success:"onPasswordDone",type:"password"})},queryPhone:function(){null==this.profile.phone||0==this.profile.phone.length?(this.phoneClassName="gray",this.phone="点击绑定"):(this.phoneClassName="black",this.phone=this.profile.phone)},queryPayment:function(){this.profile.exitsPayment?(this.paymentClassName="green",this.payment="账户安全保障中"):(this.paymentClassName="gray",this.payment="未设置")},queryWechat:function(){null==this.profile.wechatBusinessCard||0==this.profile.wechatBusinessCard.length?(this.wechatClassName="gray",this.wechat="未绑定"):(this.wechatClassName="gray",this.wechat="点击查看")},formOpenWindow:function(e){var n="generics-form/generics-form";if("nickName"==e)this.common.window.toNew(n,{formName:"nickName",title:"修改名字",topLabel:"2-24个字符，严禁出现违规内容，违者封号",value:this.profile.nickName,maxLength:24,minLength:2,success:"onNickNameChange"});else if("phone"==e)this.common.window.toNew(n,{formName:"phone",title:"绑定手机号",topLabel:"需要接收短信验证码进行身份验证",bottomLabel:"为确保您账户的安全及正常使用，依《网络安全法》相关要求，6月1日起会员账户需绑定手机。如您还未绑定，请尽快完成，感谢您的理解及支持！ ",value:this.profile.phone,maxLength:11,minLength:11,success:"onPhoneChange",type:"number"});else if("payment"==e){var o="设置支付密码";this.profile.exitsPayment&&(o="修改支付密码"),this.common.window.toNew("user/payment",{formName:"payment",title:o})}else"team"==e?this.common.window.toNew("user/team",null):"bill"==e&&this.common.window.toNew("user/bill",null)},onSmsPasswordDone:function(n){var o=this,t=n.split(",");this.$api.post("api/user/changePassword",{smsCode:t[1],password:t[2]}).then(function(n){o.common.Response.isFaild(n.data)?e.showToast({title:"获取验证码失败",icon:"none"}):o.common.Response.isException(n.data)?e.showToast({title:n.data.msg,icon:"none"}):(e.showToast({icon:"none",title:"登录密码修改成功"}),setTimeout(function(){o.logout()},1e3))})},onReSendPasswordSmsCode:function(n){var o=this;this.$api.get("api/user/sendPasswordSmsCode",{phone:n}).then(function(n){if(200!=n.data.code)return e.showToast({title:"获取验证码失败",icon:"none"}),void setTimeout(function(){o.appEvents.$emit("close__sms__Password")},2e3)})},onPasswordDone:function(n){var o=this;if(1==this.tapHz)return e.showToast({title:"操作过于频繁",icon:"none"}),void setTimeout(function(){o.tapHz=0},1e4);e.showLoading({title:"请稍后",icon:"none"}),this.tapHz=1,this.$api.get("api/user/sendPasswordSmsCode",{phone:this.profile.phone}).then(function(t){e.hideLoading(),o.tapHz=0,o.common.Response.isFaild(t.data)?e.showToast({title:"获取验证码失败",icon:"none"}):o.common.Response.isException(t.data)?e.showToast({title:t.data.msg,icon:"none"}):o.common.window.toNew("generics-sms/generics-sms",{formName:"Password",phone:o.profile.phone,ext:JSON.stringify({password:n}),success:"onSmsPasswordDone",reTry:"onReSendPasswordSmsCode"})})},onNickNameChange:function(n){var o=this;e.showLoading({title:"请稍后"}),this.$api.post("api/user/editNickName",{nickName:n}).then(function(t){e.hideLoading(),o.common.Response.isFaild(t.data)?e.showToast({icon:"none",title:"修改昵称失败"}):o.common.Response.isException(t.data)?e.showToast({icon:"none",title:t.msg}):(o.profile.nickName=n,o.appEvents.$emit("close__nickName"),setTimeout(function(){e.showToast({icon:"none",title:"名字修改成功"})},1e3))})},onPhoneChange:function(n){var o=this,t=this;11==n.length?this.$api.get("api/user/sendChangePhoneSmsCode",{phone:n}).then(function(s){t.common.Response.isFaild(s.data)?e.showToast({title:"获取失败",icon:"none"}):o.common.window.toNew("generics-sms/generics-sms",{formName:"bindPhone",phone:n,success:"onSMSbindPhoneDone",reTry:"onReSendSmsCode"})}):e.showToast({title:"请输入11位手机号码",icon:"none"})},onReSendSmsCode:function(n){var o=this;this.$api.get("api/user/sendChangePhoneSmsCode",{phone:n}).then(function(n){if(200!=n.data.code)return e.showToast({title:"获取失败",icon:"none"}),void setTimeout(function(){o.appEvents.$emit("close__sms__bindPhone")},2e3)})},onSMSbindPhoneDone:function(n){var o=n.split(","),t=this;this.$api.post("api/user/changePhone",{phone:o[0],smsCode:o[1]}).then(function(n){return t.common.Response.isFaild(n.data)?(e.showToast({title:"获取失败",icon:"none"}),void setTimeout(function(){e.navigateBack({delta:1})},3e3)):t.common.Response.isException(n.data)?(e.showToast({icon:"none",title:n.data.msg}),void setTimeout(function(){e.navigateBack({delta:1})},3e3)):(e.showToast({icon:"none",title:"绑定成功"}),void setTimeout(function(){t.profile.phone=o[0],t.profile.account=n.data.msg.account,t.session.setValue("token",n.data.msg.token),t.appEvents.$emit("close__sms__bindPhone"),t.appEvents.$emit("close__phone")},3e3))})},uploadAvatar:function(){var n=this;e.chooseImage({success:function(o){var t=o.tempFilePaths;e.uploadFile({url:a.config.baseUrl+"api/user/uploadAvatar",filePath:t[0],name:"file",formData:{token:n.session.getValue("token")},success:function(e){var o=JSON.parse(e.data);n.profile.avatar=o.msg}})}})},logout:function(){e.showLoading({title:"请稍后",mask:!0}),this.session.clear(),this.session.removeValue("token"),this.hasLogin=!1,this.sysLogout(),setTimeout(function(){e.hideLoading(),e.reLaunch({url:"/pages/user/bootstrap/login"})},2e3)}}),created:function(){this.appEvents.$on("onNickNameChange",this.onNickNameChange),this.appEvents.$on("onPhoneChange",this.onPhoneChange),this.appEvents.$on("onBindPhoneSmsChange",this.onBindPhoneSmsChange),this.appEvents.$on("onSMSbindPhoneDone",this.onSMSbindPhoneDone),this.appEvents.$on("onReSendSmsCode",this.onReSendSmsCode),this.appEvents.$on("onPasswordDone",this.onPasswordDone),this.appEvents.$on("onSmsPasswordDone",this.onSmsPasswordDone),this.appEvents.$on("onReSendPasswordSmsCode",this.onReSendPasswordSmsCode)},destroyed:function(){this.appEvents.$off("onNickNameChange"),this.appEvents.$off("onPhoneChange"),this.appEvents.$off("onBindPhoneSmsChange"),this.appEvents.$off("onSMSbindPhoneDone"),this.appEvents.$off("onReSendSmsCode"),this.appEvents.$off("onPasswordDone"),this.appEvents.$off("onSmsPasswordDone"),this.appEvents.$off("onReSendPasswordSmsCode")},data:function(){return{avatar:"../../../static/user/default-avatar.png",phoneClassName:"",paymentClassName:"",wechatClassName:"",phone:"",payment:"",wechat:"",tapHz:0}}};n.default=h}).call(this,o("6e42")["default"])},cff6:function(e,n,o){"use strict";var t=o("0c69"),s=o.n(t);s.a},e275:function(e,n,o){"use strict";o.r(n);var t=o("9564"),s=o.n(t);for(var i in t)"default"!==i&&function(e){o.d(n,e,function(){return t[e]})}(i);n["default"]=s.a}},[["fc2e","common/runtime","common/vendor"]]]);