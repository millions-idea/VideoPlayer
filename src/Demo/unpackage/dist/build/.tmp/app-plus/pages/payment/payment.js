(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/payment/payment"],{"02b9":function(t,n,e){"use strict";e.r(n);var a=e("44f3"),o=e("4f97");for(var i in o)"default"!==i&&function(t){e.d(n,t,function(){return o[t]})}(i);e("6264");var s=e("2877"),d=Object(s["a"])(o["default"],a["a"],a["b"],!1,null,"04f988f6",null);n["default"]=d.exports},"352b":function(t,n,e){},"44f3":function(t,n,e){"use strict";var a=function(){var t=this,n=t.$createElement;t._self._c},o=[];e.d(n,"a",function(){return a}),e.d(n,"b",function(){return o})},"4f97":function(t,n,e){"use strict";e.r(n);var a=e("8aa9"),o=e.n(a);for(var i in a)"default"!==i&&function(t){e.d(n,t,function(){return a[t]})}(i);n["default"]=o.a},6264:function(t,n,e){"use strict";var a=e("352b"),o=e.n(a);o.a},"8aa9":function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=e("2f62");function o(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{},a=Object.keys(e);"function"===typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.forEach(function(n){i(t,n,e[n])})}return t}function i(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}var s={data:function(){return{buttonDisabled:!0,changeValue:"",title:"",amount:0,id:"",balance:""}},computed:o({},(0,a.mapState)(["hasLogin","profile"]),{isInput:function(){return 0==this.changeValue.length},getTitle:function(){return this.common.String.textLimit(this.title,12)}}),methods:o({},(0,a.mapActions)(["setProfile","authOpenWindow"]),{downloadApp:function(){this.common.window.toNew("generics-webview/generics-webview",{url:this.session.getValue("homeConfig").appDownloadLink})},changeInput:function(t){this.changeValue=t.detail.value},useBalance:function(){this.appEvents.$off("onInputPaymentPassword",this.onInputPaymentPassword),this.appEvents.$on("onInputPaymentPassword",this.onInputPaymentPassword),this.common.window.toNew("user/payment",{formName:"payment",title:"输入支付密码",callback:"onInputPaymentPassword"})},useAlipay:function(){this.onInputPaymentPasswordWithAlipay()},useWechat:function(){this.onInputPaymentPasswordWithWechat()},onInputPaymentPassword:function(n){t.showLoading({title:"请稍后",mask:!0});var e=this;e.$api.get("api/user/verifyPaymentPassword",{password:n}).then(function(n){t.hideLoading(),e.common.Response.isFaild(n.data)?t.showToast({icon:"none",title:"支付密码输入错误"}):e.common.Response.isException(n.data)?t.showToast({icon:"none",title:n.data.msg}):(t.showLoading({title:"支付中",mask:!0}),e.$api.get("api/order/buy",{id:e.id,channel:"balance",amount:e.amount}).then(function(n){return e.common.Response.isFaild(n.data)?(n.data.msg.length<10&&-1==n.data.msg.indexOf("null")?t.showToast({icon:"none",title:n.data.msg}):t.showToast({icon:"none",title:"订单失败，请联系在线客服处理！"}),void setTimeout(function(){t.navigateBack({delta:1})},1e3)):e.common.Response.isException(n.data)?"fail"==n.data.msg||n.data.msg.indexOf("null")?(t.showToast({icon:"none",title:"订单错误，请联系在线客服处理！"}),void setTimeout(function(){t.navigateBack({delta:1})},1e3)):(t.showToast({icon:"none",title:n.data.msg}),void setTimeout(function(){t.navigateBack({delta:1})},2e3)):void e.$api.get("api/order/payment",{orderId:n.data.msg,channel:"balance",amount:e.amount}).then(function(n){return t.hideLoading(),e.common.Response.isFaild(n.data)?(n.data.msg.length<10&&-1==n.data.msg.indexOf("null")&&-1==n.data.msg.indexOf("fail")?t.showToast({icon:"none",title:n.data.msg}):t.showToast({icon:"none",title:"支付失败"}),void setTimeout(function(){t.navigateBack({delta:1})},1e3)):e.common.Response.isException(n.data)?(t.showToast({icon:"none",title:n.data.msg}),void setTimeout(function(){t.navigateBack({delta:1})},1e3)):(t.showToast({icon:"none",title:"支付成功, 稍后跳转……"}),void setTimeout(function(){t.reLaunch({url:"/pages/user/index/index"})},1e3))})}))})},onInputPaymentPasswordWithAlipay:function(n){var e=this;t.showLoading({title:"请稍后",mask:!0});var a=this;a.$api.get("api/order/buy",{id:a.id,channel:"alipay",amount:a.amount}).then(function(n){return t.hideLoading(),a.common.Response.isFaild(n.data)?(n.data.msg.length<10&&-1==n.data.msg.indexOf("null")&&-1==n.data.msg.indexOf("faild")?t.showToast({icon:"none",title:n.data.msg}):t.showToast({icon:"none",title:"订单失败，请联系在线客服处理！"}),void setTimeout(function(){t.navigateBack({delta:1})},3e3)):a.common.Response.isException(n.data)?("fail"!=n.data.msg&&-1==n.data.msg.indexOf("null")||(t.showToast({icon:"none",title:"支付失败，请联系在线客服处理！"}),setTimeout(function(){t.navigateBack({delta:1})},1e3)),t.showToast({icon:"none",title:n.data.msg}),void setTimeout(function(){t.navigateBack({delta:1})},3e3)):void e.$api.get("api/order/huPayment",{amount:a.amount,outTradeNo:n.data.msg}).then(function(n){t.hideLoading(),e.common.window.toNew("generics-webview/generics-webview",{url:n.data,title:"手机支付"})})})},onInputPaymentPasswordWithWechat:function(n){var e=this;t.showLoading({title:"请稍后",mask:!0});var a=this;a.$api.get("api/order/buy",{id:a.id,channel:"wxpay"}).then(function(n){return t.hideLoading(),a.common.Response.isFaild(n.data)?(n.data.msg.length<10&&-1==n.data.msg.indexOf("null")&&-1==n.data.msg.indexOf("faild")?t.showToast({icon:"none",title:n.data.msg}):t.showToast({icon:"none",title:"订单失败，请联系在线客服处理！"}),void setTimeout(function(){t.navigateBack({delta:1})},3e3)):a.common.Response.isException(n.data)?("fail"!=n.data.msg&&-1==n.data.msg.indexOf("null")||(t.showToast({icon:"none",title:"支付失败，请联系在线客服处理！"}),setTimeout(function(){t.navigateBack({delta:1})},1e3)),t.showToast({icon:"none",title:n.data.msg}),void setTimeout(function(){t.navigateBack({delta:1})},3e3)):void e.$api.get("api/wx/unifiedOrder",{totalFee:a.amount,outTradeNo:n.data.msg}).then(function(n){if(t.hideLoading(),null!=n.data&&JSON.stringify(n.data).length>5)try{WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:n.data.appId,timeStamp:n.data.timeStamp,nonceStr:n.data.nonceStr,package:n.data.package,signType:n.data.signType,paySign:n.data.paySign},function(n){"get_brand_wcpay_request:ok"==n.err_msg?(console.log("支付成功"," at pages\\payment\\payment.vue:432"),t.showToast({icon:"none",title:"支付成功, 稍后跳转……"}),setTimeout(function(){t.reLaunch({url:"/pages/user/index/index"})},3e3)):"get_brand_wcpay_request:cancel"==n.err_msg?(console.log("支付取消"," at pages\\payment\\payment.vue:444"),t.showToast({icon:"none",title:"支付中途取消"}),setTimeout(function(){t.navigateBack({delta:1})},1e3)):"get_brand_wcpay_request:fail"==n.err_msg&&(console.log("支付失败"," at pages\\payment\\payment.vue:455"),a.session.setValue("recharge_wxpay_error",JSON.stringify(err)),t.showToast({icon:"none",title:"支付失败"}),setTimeout(function(){t.navigateBack({delta:1})},1e3))})}catch(e){a.common.window.logger("getBrandWCPayRequest_exception_"+JSON.stringify(e)),t.hideLoading(),t.showToast({title:"拉起支付请求失败",icon:"none"})}else t.hideLoading(),t.showToast({title:"拉起支付请求失败",icon:"none"})})})},getBalance:function(){var n=this;this.$api.get("api/bill/getBalance",{}).then(function(e){return n.common.Response.isFaild(e.data)?(t.showToast({title:"获取可用余额超时",icon:"none"}),void(n.balance="-")):n.common.Response.isException(e.data)?(t.showToast({title:e.data.msg,icon:"none"}),void(n.balance="-")):void(n.balance=e.data.msg)})}}),onShow:function(){this.hasLogin||t.reLaunch({url:"../../user/bootstrap/login"})},onLoad:function(n){var e=this;if(this.title=n.title,this.amount=n.amount,this.id=n.id,null==this.id){if(t.showLoading({title:"请稍后",mask:!1}),this.profile.isVip)return t.hideLoading(),t.showToast({title:"您已经是VIP会员啦",icon:"none"}),void setTimeout(function(){t.navigateBack({delta:1})},1e3);this.$api.get("api/user/getVipOrderInfo",{}).then(function(n){t.hideLoading(),e.common.Response.isFaild(n.data)?t.showToast({title:"拉取服务器信息超时",icon:"none"}):e.common.Response.isException(n.data)?t.showToast({title:n.data.msg,icon:"none"}):(e.title=n.data.msg.title,e.amount=n.data.msg.amount,e.id=n.data.msg.id)})}this.getBalance()}};n.default=s}).call(this,e("6e42")["default"])}},[["bba1","common/runtime","common/vendor"]]]);